import{_ as U}from"./movie-card.vue_vue_type_script_setup_true_lang-D9t6ewE2.js";import{E as D,d as F,r as f,J as O,S as q,n as A,i as L,u as H,Q as I,j as W,o as g,c as R,w as d,f as v,e as $,q as G,h as J,b as E,F as Q,k as X,p as K,$ as w,_ as Y,s as Z}from"./index-CKOHag-y.js";import{P as ee,V as te}from"./index.min-nt4-KpHg.js";import{a as ae,u as S,f as y}from"./movie-COQLQBWO.js";import{_ as se}from"./Rate-c-BPAtkZ.js";import{_ as oe}from"./Flex-mlOFTHkc.js";import"./headers-Bl_Kd_Jk.js";import"./p-BYwIBpBM.js";import"./get-slot-Bk_rJcZu.js";const re=Object.assign(Object.assign({},D.props),{trigger:String,xScrollable:Boolean,onScroll:Function,contentClass:String,contentStyle:[Object,String],size:Number,yPlacement:{type:String,default:"right"},xPlacement:{type:String,default:"bottom"}}),ne=F({name:"Scrollbar",props:re,setup(){const p=f(null);return Object.assign(Object.assign({},{scrollTo:(...r)=>{var l;(l=p.value)===null||l===void 0||l.scrollTo(r[0],r[1])},scrollBy:(...r)=>{var l;(l=p.value)===null||l===void 0||l.scrollBy(r[0],r[1])}}),{scrollbarInstRef:p})},render(){return O(q,Object.assign({ref:"scrollbarInstRef"},this.$props),this.$slots)}}),le={key:0},ge=F({name:"detail-page_video-player",__name:"index",setup(p){const _=A(),r=L(),{routerBack:l}=H(),t=f({createdTime:"",viewCount:0,favorite:!1,personalScore:void 0,uniqueid:"",num:"",title:"",originTitle:"",introduction:"",file:"",torrent:"",cover:"",poster:"",tags:"",genres:"",studio:"",country:"",series:"",actress:"",director:"",year:0,releaseTime:"",score:0,fileSize:0}),u=f();function M(a){u.value!==void 0&&(u.value.src=N(`/${a}`))}function N(a){return console.log(a),a.endsWith(".strm")?b(r.projectSettings.serviceUrl+a):r.projectSettings.serviceUrl+a}const c=f([]);function b(a){try{const e=new XMLHttpRequest;if(e.open("GET",a,!1),e.send(null),e.status!==200)throw new Error(`Failed to fetch strm file: ${e.status}`);const s=e.responseText;if(!s.match(/^https?:\/\//))throw new Error("Invalid URL format in strm file");return s.trim()}catch(e){throw console.error("Error reading strm file:",e),e}}function j(){t.value.viewCount++,t.value.viewTime=Date.now(),S(t.value)}I(()=>_.query.num,async()=>{await x()},{immediate:!0});const n=f([]);async function T(){if(n.value=[],t.value.actress.split("|")[0].length>0){const e={sort:"year",sortRule:"DESC",actress:t.value.actress.split("|")[0],page:1,pageSize:6},s=await y(e);s.data&&s.data.records.forEach(o=>{t.value.num!==o.num&&!n.value.some(i=>i.num===o.num)&&n.value.push(o)})}if(t.value.series.trim().length>0){const e=await y({series:t.value.series,page:1,pageSize:4,sort:"id",sortRule:"DESC",folder:null});e.data&&e.data.records.forEach(s=>{t.value.num!==s.num&&!n.value.some(o=>o.num===s.num)&&n.value.push(s)})}if(n.value.length===0){const e=await y({page:1,pageSize:6,sort:"id",sortRule:"RAND",folder:null});e.data&&e.data.records.forEach(s=>{t.value.num!==s.num&&!n.value.some(o=>o.num===s.num)&&n.value.push(s)})}}async function x(){var e;const a=await ae(_.query.num);a.data?(t.value=a.data,j(),c.value=t.value.file.slice(1).split("|").filter(s=>s.length>0),M(c.value[0]),await T()):(e=window.$message)==null||e.warning("找不到视频")}function V(){t.value.favorite=!t.value.favorite,t.value.favoriteTime=Date.now(),S(t.value).then(a=>{var e;a.data&&((e=window.$message)==null||e.success(t.value.favorite?w("common.addFavorite"):w("common.removeFavorite")))})}function k(){S(t.value).then(a=>{var e;a.data&&((e=window.$message)==null||e.success(w("common.saveSuccess")))})}return W(async()=>{await x();let a=`${r.projectSettings.serviceUrl}${c.value[0]}`;c.value[0].endsWith(".strm")&&(a=b(a));const e=window.innerWidth-300-24,s=window.innerHeight-150;let o=Math.min(e,s/9*16),i=o/16*9;i>s&&(i=s,o=i/9*16),u.value=new ee({id:"mse",url:a,playNext:{urlList:c},width:o,height:i,autoplay:!0,volume:r.videoVolume,cssFullscreen:!0,fullscreen:!1,hardwareAcceleration:!0,closeVideoDblclick:!0,preloadTime:30,bufferBehind:60,videoBuffer:1.5,cors:!0}),u.value.on(te,()=>{var h;r.videoVolume=((h=u.value)==null?void 0:h.volume)??0})}),(a,e)=>{const s=Y,o=se,i=Z,h=U,B=ne,z=oe;return g(),R(z,{justify:"center"},{default:d(()=>{var C;return[v(i,{bordered:!1,title:(C=t.value)==null?void 0:C.title,class:"ma-0 h-auto w-auto pa-0","content-style":"padding: 0;",size:"small",closable:"",onClose:J(l)},{"header-extra":d(()=>{var m;return[$("span",{class:"z-3 inline-block h-8 w-8 cursor-pointer rd-50% pa-1 v-mid color-light hover:bg-primary",onClick:V},[v(s,{class:G(["ma-auto size-6",(m=t.value)!=null&&m.favorite?"color-#F8312F":"color-gray"]),icon:"solar:heart-angle-bold"},null,8,["class"])]),v(o,{value:t.value.personalScore,"onUpdate:value":[e[0]||(e[0]=P=>t.value.personalScore=P),k],"allow-half":"",class:"h-6 px-2",count:5},null,8,["value"])]}),default:d(()=>[e[1]||(e[1]=$("div",{id:"mse"},null,-1))]),_:1},8,["title","onClose"]),v(i,{bordered:!1,class:"w-64",title:"更多影片"},{default:d(()=>[n.value.length>1?(g(),E("div",le,[v(B,{class:"h-80vh"},{default:d(()=>[(g(!0),E(Q,null,X(n.value,m=>(g(),R(h,{key:m.num,movie:m,class:"mb-4 w-48",sort:"personalScore"},null,8,["movie"]))),128))]),_:1})])):K("",!0)]),_:1})]}),_:1})}}});export{ge as default};
